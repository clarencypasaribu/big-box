generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
  schemas   = ["public"]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model blockers {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  task_id       String   @db.Uuid
  task_title    String?
  project_id    String   @db.Uuid
  project_name  String?
  title         String?
  product       String?
  reason        String?
  notes         String?
  reporter_id   String   @db.Uuid
  reporter_name String?
  pm_id         String   @db.Uuid
  status        String   @default("Open")
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @default(now()) @db.Timestamptz(6)
  assignee_id   String?  @db.Uuid
  assignee_name String?

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model files {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String
  size        Int
  type        String
  data        String
  entity_type String
  entity_id   String   @db.Uuid
  uploader_id String?  @db.Uuid
  created_at  DateTime @default(now()) @db.Timestamptz(6)

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model profiles {
  id         String   @id @db.Uuid
  email      String
  full_name  String?
  first_name String?
  last_name  String?
  phone      String?
  position   String?
  bio        String?
  role       String?
  is_active  Boolean  @default(true)
  avatar_url String?
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @default(now()) @db.Timestamptz(6)

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model project_members {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id String   @db.Uuid
  member_id  String   @db.Uuid
  role       String?
  created_at DateTime @default(now()) @db.Timestamptz(6)
  projects   projects @relation(fields: [project_id], references: [id])

  @@unique([project_id, member_id])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model project_stage_approvals {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id   String    @db.Uuid
  stage_id     String
  status       String    @default("Pending")
  requested_by String?   @db.Uuid
  approved_by  String?   @db.Uuid
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  approved_at  DateTime? @db.Timestamptz(6)

  @@unique([project_id, stage_id])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model projects {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String
  code            String?
  location        String?
  status          String            @default("In Progress")
  progress        Int               @default(0)
  lead            String?
  icon_bg         String?
  description     String?
  owner_id        String?           @db.Uuid
  created_at      DateTime          @default(now()) @db.Timestamptz(6)
  updated_at      DateTime          @default(now()) @db.Timestamptz(6)
  start_date      DateTime?         @db.Date
  end_date        DateTime?         @db.Date
  team_members    String[]
  project_members project_members[]
  tasks           tasks[]

  @@schema("public")
}

model task_comments {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  task_id    String   @db.Uuid
  author     String
  text       String
  created_at DateTime @default(now()) @db.Timestamptz(6)
  tasks      tasks    @relation(fields: [task_id], references: [id])

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model task_deliverables {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  task_id     String   @db.Uuid
  notes       String?
  data_ingest String?
  created_at  DateTime @default(now()) @db.Timestamptz(6)

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model tasks {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  seed_key      String?         @unique
  title         String
  description   String?
  status        String
  priority      String?
  stage         String?
  due_date      String?
  created_by    String?
  project_id    String          @db.Uuid
  created_at    DateTime        @default(now()) @db.Timestamptz(6)
  updated_at    DateTime        @default(now()) @db.Timestamptz(6)
  assignee      String?
  phase         String?
  task_comments task_comments[]
  projects      projects        @relation(fields: [project_id], references: [id])

  @@schema("public")
}

model notifications {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String   @db.Uuid
  title      String
  message    String
  type       String
  link       String?
  is_read    Boolean  @default(false)
  created_at DateTime @default(now()) @db.Timestamptz(6)

  @@schema("public")
}
